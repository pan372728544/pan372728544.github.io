(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{359:function(s,t,a){s.exports=a.p+"assets/img/9.3b0688f1.png"},360:function(s,t,a){s.exports=a.p+"assets/img/10.476a917d.png"},361:function(s,t,a){s.exports=a.p+"assets/img/11.f0676319.png"},362:function(s,t,a){s.exports=a.p+"assets/img/12.cf18fea0.png"},363:function(s,t,a){s.exports=a.p+"assets/img/13.ed281608.png"},364:function(s,t,a){s.exports=a.p+"assets/img/14.192b354f.png"},428:function(s,t,a){"use strict";a.r(t);var n=[function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"object-c-对象的本质-下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#object-c-对象的本质-下","aria-hidden":"true"}},[s._v("#")]),s._v(" Object-C - 对象的本质(下)")]),s._v(" "),n("p",[s._v("OC对象的分类，对象的isa指针指向哪里，superClass指针，OC的类信息存放在哪里？")]),s._v(" "),n("p",[s._v("上篇文章中，我们讲述了一个 NSObject实例对象，Person实例对象的本质，在内存中长什么样子。但是，上篇文章中讲的OC对象的本质，还不包括所有的OC对象。")]),s._v(" "),n("h2",{attrs:{id:"_1-oc对象的分类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-oc对象的分类","aria-hidden":"true"}},[s._v("#")]),s._v(" 1.OC对象的分类")]),s._v(" "),n("p",[s._v("Objective-C中的对象，简称OC对象，主要可以分为 3 种：")]),s._v(" "),n("ul",[n("li",[s._v("instance对象（实例对象）\ninstance对象就是通过类alloc出来的对象，每次调用alloc都会产生新的instance对象")])]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("object1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("object2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:a(359),alt:"ss"}})]),s._v(" "),n("p",[s._v("1> object1、object2是NSObject的instance对象（实例对象)")]),s._v(" "),n("p",[s._v("2> 它们是不同的两个对象，分别占据着两块不同的内存")]),s._v(" "),n("p",[s._v("3> instance对象在内存中存储信息包括：isa指针、其他成员变量")]),s._v(" "),n("ul",[n("li",[s._v("class对象（类对象）")])]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// instance 对象，实例对象")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" alloc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// class 对象，类对象      ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("objectClass1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("object "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("objectClass2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// class 方法返回的一直是class对象，类对象")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Class objectClass2 = [[[[NSObject class] class] class] class];")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("objectClass3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("object_getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 0x100444830 0x7fffa5ab9140 0x7fffa5ab9140 0x7fffa5ab9140")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NSLog")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%p %p %p %p"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" objectClass1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" objectClass2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" objectClass3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("img",{attrs:{src:a(360),alt:"ss"}})]),s._v(" "),n("p",[s._v("1> objectClass1~objectClass3都是NSObject的class对象（类对象）")]),s._v(" "),n("p",[s._v("2> 它们都是同一个对象，每个类在内存中有且只有一个class对象")]),s._v(" "),n("p",[s._v("3> class对象在内存中存储的信息主要包括：isa指针、superClass指针、类的属性信息（@property）、类的实例方法信息（instance method）、类的协议信息（protocol）、类的成员变量信息（ivar，这里指的并不是成员变量的值是多少，成员变量的值是实例对象进行存储的，类对象存储的是成员变量的类型、变量名等只需要存储一份的）等...")]),s._v(" "),n("ul",[n("li",[s._v("meta-class对象（元类对象）")])]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// class 对象，类对象")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("objectClass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("object "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// meta-class 对象，元类对象")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将类对象当做参数传入，获得元类对象;将实例对象当做参数传入，获得的是类对象")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("metaClass1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("object_getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("object "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("metaClass2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("object_getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("NSObject")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("metaClass3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("object_getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("object_getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 0x7fffa5ab90f0 0x7fffa5ab90f0 0x7fffa5ab90f0 0 1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NSLog")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%p %p %p %d %d"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" metaClass1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" metaClass2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" metaClass3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("class_isMetaClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("objectClass"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("class_isMetaClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("metaClass1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("1> objectMetaClass是NSObject的meta-class对象（元类对象）\n2> 每个类在内存中有且只有一个meta-class对象\n3> meta-class对象和class对象的内存结构是一样的（都是 Class 类型），但是用途不一样，在内存中存储的信息主要包括：isa指针、superClass指针、类的类方法信息（class method）、等...\n"),n("img",{attrs:{src:a(361),alt:"ss"}})]),s._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("注意：为什么说 meta-class 对象和 class 对象结构一样，但是图上画的却不一样呢，因为图上只是将比较重要的一些东西摘了出来，方便理解。其实本质是，class对象类方法信息存储的可能是null空的，meta-class内部属性信息、对象方法信息、协议信息、成员变量信息存储的可能是null空的。")])]),s._v(" "),n("p",[n("strong",[s._v("objc_getClass、object_getClass方法区别？")])]),s._v(" "),n("p",[s._v("本文和上篇文章有用到这几个方法，这几个方法有什么区别呢？")]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("objc_getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("const char "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("aClassName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("aClassName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// NO unconnected, YES class handler")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("look_up_class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("aClassName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NO")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("YES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("object_getClass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果传入instance对象，返回class对象")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果传入class对象，返回meta-class对象")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如果传入meta-class对象，返回NSObject的meta-class对象")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" obj"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getIsa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Nil")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("从源码进行分析，objc_getClass传入参数为字符串，根据字符串去Map中取出类对象并返回。 object_getClass传入参数为 id，并且返回值是通过 getIsa 获得，说明返回 isa 指向的类型（即：传入instance对象，返回类对象；传入class对象，返回meta-class对象；传入meta-class对象，返回NSObject的meta-class对象）。")]),s._v(" "),n("h2",{attrs:{id:"_2-isa指针"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-isa指针","aria-hidden":"true"}},[s._v("#")]),s._v(" 2.isa指针")]),s._v(" "),n("p",[s._v("我们发现，OC对象不管是instance对象、类对象还是meta-class都有一个isa指针，那么，isa指针都指向哪里呢，起到了什么作用。\n我们都知道，OC对象调用方法是通过消息机制实现的，通过上面的总结我们也知道了实例方法存放在class对象中，类方法存放在meta-class对象中，那么对象是怎么查找到方法并实现调用呢？\n这个时候就需要isa指针了，instance对象的isa指针指向class对象，class对象的isa指向meta-class对象，通过isa指针，instance对象、class对象、meta-class对象就可以串起来了，方法调用、以及各种作用就都可以实现了。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(362),alt:"ss"}})]),s._v(" "),n("ul",[n("li",[s._v("instance对象的isa指向class对象，当调用对象方法时，通过instance对象的isa找到class对象，最后找到对象方法的实现进行调用")]),s._v(" "),n("li",[s._v("class对象的isa指向meta-class对象，当调用类方法时，通过class对象的isa找到meta-class对象，最后找到类方法的实现进行调用")])]),s._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("注意：isa指针并不是直接指向对象地址值，还需要逻辑与上一个掩码 ISA_MASK，这个了解下就行，如果不了解的话可以直接理解为isa直接指向class对象、meta-class对象。")])]),s._v(" "),n("p",[n("strong",[s._v("superClass指针")]),s._v("\n附上一张经典的图：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(363),alt:"ss"}}),s._v("\n总结如下：")]),s._v(" "),n("ul",[n("li",[s._v("instance对象的isa指向class对象")]),s._v(" "),n("li",[s._v("class对象的isa指向meta-class对象")]),s._v(" "),n("li",[s._v("meta-class对象的isa指向基类的meta-class对象")]),s._v(" "),n("li",[s._v("class对象的superClass指向父类的class对象，如果没有父类，superClass指针为nil")]),s._v(" "),n("li",[s._v("meta-class对象的superClass指针指向父类的meta-class对象，基类的meta-class对象的")]),s._v(" "),n("li",[s._v("superClass指针指向基类的class对象")]),s._v(" "),n("li",[s._v("instance调用方法的轨迹，isa找到class对象，方法不存在，就通过superClass寻找父类")]),s._v(" "),n("li",[s._v("class调用类方法的轨迹，isa找到meta-class，方法不存在，就通过superClass寻找父类")])]),s._v(" "),n("h2",{attrs:{id:"_3-窥探-objc-class-结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-窥探-objc-class-结构","aria-hidden":"true"}},[s._v("#")]),s._v(" 3.窥探 objc_class 结构")]),s._v(" "),n("p",[s._v("类对象与元类对象的结构是一样的，通过都是class类型就可以证明。即 *typedef struct objc_class Class; 这个结构体，接下来我们一起来探究下这个结构体内部结构。\n我们搞懂这个结构体之后也就可以知道class对象和meta-class对象里面到底放了什么东西了。\n点击 objc_class 进入：")]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" objc_class "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("_Nonnull")]),s._v(" isa  "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OBJC_ISA_AVAILABILITY")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    #"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("__OBJC2__\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("_Nullable")]),s._v(" super_class                              "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    const char "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" _Nonnull name                               "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    long version                                             "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    long info                                                "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    long instance_size                                       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" objc_ivar_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" _Nullable ivars                  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" objc_method_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" _Nullable "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" _Nullable methodLists                    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" objc_cache "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" _Nonnull cache                       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" objc_protocol_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" _Nullable protocols          "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #endif\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("OBJC2_UNAVAILABLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("进入之后，我们发现，内部如我们想象之中差不多，确实是有 ivars、methodLists、protocols之类的。\n但是，我们发现里面有一个条件编译：#if !OBJC2，意思是如果不是 OBJC2 的话才会编译这段代码，现在最新已经是 OC2.0 了，所以，这段代码相当于已经过时了，这个结构体在 OC2.0 时已经不可用了，我们要研究学习的话建议还是参考最新的代码，这个已经研究价值不大了。\n打开上篇文章带领大家下载的 objc4源码，搜索 struct objc_class， 找到 objc-runtime-new.h 中 结构体的最新定义：\n我们发现 struct objc_class : objc_object，结构体也可以继承，对，没错，这是 C++ 语法，C++ 里面的结构体跟类其实区别不大，基本上卫衣的区别是成员变量默认 public 还是private。C++ 结构体里面还可以定义方法。")]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" objc_object "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    isa_t isa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ISA() assumes this is NOT a tagged pointer object")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ISA")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// getIsa() allows this to be a tagged pointer object")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("getIsa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    方便理解，部分与本文讲述联系不大的先省略了，感兴趣的同学可以自行查看\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("我们可以发现：struct objc_object 结构体内部只有一个 isa 成员以及一些方法。")]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" objc_class "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" objc_object "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Class ISA;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("Class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("superclass")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    cache_t cache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// formerly cache pointer and vtable")]),s._v("\n    class_data_bits_t bits"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// class_rw_t * plus custom rr/alloc flags")]),s._v("\n\n    class_rw_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" bits"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    void "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("class_rw_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("newData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        bits"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    void "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uint32_t "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("assert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isFuture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRealized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setFlags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    void "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("clearInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uint32_t clear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("assert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isFuture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isRealized")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("clearFlags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clear"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    方便理解，部分与本文讲述联系不大的先省略了，感兴趣的同学可以自行查看\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("我们发现其内部有一个 class_rw_t，即可读、可写、table，一个可读可写的表格，而且一些信息都在这个表格里面：")]),s._v(" "),n("div",{staticClass:"language-swift line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-swift"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" class_rw_t "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Be warned that Symbolication knows the layout of this structure.")]),s._v("\n    uint32_t flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    uint32_t version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    const class_ro_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("ro"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    method_array_t methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    property_array_t properties"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    protocol_array_t protocols"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    方便理解，部分与本文讲述联系不大的先省略了，感兴趣的同学可以自行查看\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" class_ro_t "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    uint32_t flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    uint32_t instanceStart"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    uint32_t instanceSize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #ifdef __LP64__\n    uint32_t reserved"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    #endif\n\n    const uint8_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" ivarLayout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    const char "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    method_list_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" baseMethodList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    protocol_list_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" baseProtocols"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    const ivar_list_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" ivars"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    const uint8_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" weakIvarLayout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    property_list_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("baseProperties"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    method_list_t "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("baseMethods")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" const "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" baseMethodList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[s._v("总结如下图：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(364),alt:"ss"}})]),s._v(" "),n("p",[s._v("总结： 通过 struct objc_class 内部结构，内部确实有存放 方法、成员变量、协议 的数组，也证明 class对象/meta-class对象 内部确实是如我们所才像一样。对象方法、属性、成员变量、协议信息，存放在class对象中；类方法，存放在meta-class对象中；成员变量的具体值，存放在instance对象中。")])])}],e=a(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);r.options.__file="instance2.md";t.default=r.exports}}]);